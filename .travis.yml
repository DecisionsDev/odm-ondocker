language: generic
cache:
  directories:
  - "$HOME/.cache"
sudo: required
services:
- docker
env:
  matrix:
  - DOCKER_COMPOSE_VERSION=1.21.1
  global:
    secure: mUyeRn+M78zsRnHGO/6IcMXAs5Zee4QzWni43Kxc9jpsfE4M0mxbTJw1fqlHnru76mJDHndzharmBKD810rmNCUt5v5u9rv1If2yH1KUMUQXD+UajXrjB7l76c9HB367MFPSDAxEIqZKNmK56XOlrErW22gFIkCxdpwNQ/ykb/0B41LqdX0rf5d34omtK5VmsAZs3APNqoVod8kNyibcG9DHOWscVgo1tnvlB61lJyy61SfGGIB3F1i87dcK0VT/fXZ0Hspx6iAtxVi/G4Kfz7Izsx8kEJ3M5c3glnf43He/hdECHYYsXIu6ytrJ5RbUoPJH4QGk44unckMMIArwIE9BtbyiGSnOANd3jTg2TDKPEoiCLaA4QSjjLhk3ZUqGwkUe5XVF9CaZGozaSSV+9caaJemkN9ye1yFuAQdLCy+wr/o2TqyscDT3vM3QejT36Ztl+IKzVyB9u61TE9rN4X2sKmkEYV2k4y/ZrMu3dLtVjLyInr37xwm2Bo9Ml5S1+IZqgQUSBSnmj2CY25BLbXp7kfBaxzmJiOL0usUJP+9FwWQ1ZriJvkS6CyKSGqLGVpIylCNClmJy+yDK3Tbwl89HMOr+3zlZ7fBK59YKlVtmbQAGI3kEAFKVSJBmu1XqrNL9Mlh1vg/FP6D8v9bHzmulCBSt+3gE3zBQ4UDRjZ4=
before_install:
- mkdir -p $HOME/.cache
- sudo rm /usr/local/bin/docker-compose
- curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname
  -s`-`uname -m` > docker-compose
- chmod +x docker-compose
- sudo mv docker-compose /usr/local/bin
- docker --version
- docker-compose version
script:
- sh -c "! egrep  -ri '(LICENSE[D]?).*(IBM)' --exclude='*.tar.gz' --exclude='.travis.yml'
  --exclude-dir='licenses' --exclude=index.jsp --exclude=error.jsp --exclude-dir='dockerhub'
  ."
- chmod +x build.sh
- "./build.sh"
- sudo service postgresql stop
- while sudo lsof -Pi :5432 -sTCP:LISTEN -t; do sleep 1; done
- export LICENSE=accept
- docker-compose up -d
- "./test/suite.sh"
notifications:
  slack: ibm-cloud:LbtLkB6RShLAntBS4thdFlqY
